#!/usr/bin/env bash
# Claude Codeã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰: /commit
# ä¼šè©±ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ã¦ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹

# ç¾åœ¨ã®å¤‰æ›´çŠ¶æ³ã‚’ç¢ºèª
echo "ğŸ” ç¾åœ¨ã®å¤‰æ›´ã‚’ç¢ºèªã—ã¦ã„ã¾ã™..."

# git statusã‚’å®Ÿè¡Œ
GIT_STATUS=$(git status --porcelain 2>/dev/null)

if [ -z "$GIT_STATUS" ]; then
    echo "ğŸ“­ ã‚³ãƒŸãƒƒãƒˆã™ã‚‹å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
    exit 0
fi

echo "ğŸ“ ä»¥ä¸‹ã®å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼š"
echo "$GIT_STATUS"
echo ""

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚‹å ´åˆ
UNSTAGED_CHANGES=$(git status --porcelain | grep -E '^( M|MM|\?\?)' || true)
if [ -n "$UNSTAGED_CHANGES" ]; then
    echo "âš ï¸  ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚Šã¾ã™ï¼š"
    echo "$UNSTAGED_CHANGES"
    echo ""
    echo "ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚‚ã‚³ãƒŸãƒƒãƒˆã«å«ã‚ã¾ã™ã‹ï¼Ÿ (y/N)"
    read -r INCLUDE_UNSTAGED
    
    if [ "$INCLUDE_UNSTAGED" = "y" ] || [ "$INCLUDE_UNSTAGED" = "Y" ]; then
        echo "ğŸ“¦ ã™ã¹ã¦ã®å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦ã„ã¾ã™..."
        git add -A
    fi
fi

# ä¼šè©±ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
echo ""
echo "ğŸ¤– ä¼šè©±ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†æã—ã¦ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¾ã™..."
echo ""
echo "ä»¥ä¸‹ã®æƒ…å ±ã‚’åŸºã«ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š"
echo "1. ä»Šå›ã®ä¼šè©±ã§è¡Œã£ãŸå¤‰æ›´å†…å®¹"
echo "2. å¤‰æ›´ã®ç›®çš„ã¨èƒŒæ™¯"
echo "3. Conventional Commitså½¢å¼ã«å¾“ã†"
echo ""
echo "ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š"

# ã“ã“ã§ClaudeãŒä¼šè©±ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
COMMIT_MESSAGE="feat: Claude Code ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã®æœ€é©åŒ–

- ~/.claude/settings.json: ãƒ¢ãƒ€ãƒ³ãªé–‹ç™ºç’°å¢ƒè¨­å®šã‚’è¿½åŠ 
  - ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã§ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†æ™‚ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»Lint
  - pnpmå„ªå…ˆã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆ¶å¾¡
  - ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¨©é™è¨­å®š
- ~/.claude/CLAUDE.md: é–‹ç™ºåŸå‰‡ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å®šç¾©
- ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã®åŸºç›¤ã‚’æ§‹ç¯‰"

echo "$COMMIT_MESSAGE"
echo ""

# ã‚³ãƒŸãƒƒãƒˆã®å®Ÿè¡Œç¢ºèª
echo "ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ (y/N/e[dit])"
read -r CONFIRM

case "$CONFIRM" in
    y|Y)
        git commit -m "$COMMIT_MESSAGE"
        echo "âœ… ã‚³ãƒŸãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼"
        ;;
    e|E)
        # ã‚¨ãƒ‡ã‚£ã‚¿ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†
        echo "$COMMIT_MESSAGE" > /tmp/commit_msg.txt
        ${EDITOR:-vim} /tmp/commit_msg.txt
        git commit -F /tmp/commit_msg.txt
        rm /tmp/commit_msg.txt
        echo "âœ… ã‚³ãƒŸãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼"
        ;;
    *)
        echo "âŒ ã‚³ãƒŸãƒƒãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚"
        exit 1
        ;;
esac